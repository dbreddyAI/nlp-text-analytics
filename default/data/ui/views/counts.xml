<!--<dashboard hideEdit="true">--><form script="tabledatabar.js" stylesheet="tabledatabar.css">
  <label>Counts</label>
  <search id="base_search">
    <query>
$master_search$
| cleantext textfield=$textfield$ base_type=lemma_pos $stopwords$ $custom_stopwords$
    </query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search base="base_search" id="counts">
    <query>
| stats count BY $textfield$
| search $textfield$!=""
| sort -count
</query>
  </search>
  <fieldset submitButton="true" autoRun="false">
    <input type="time" token="time">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input id="text_long" type="text" token="master_search">
      <label>Text Search (output must be tabular-i.e. ... | table text)</label>
      <default></default>
    </input>
    <html>
      <p/>
      <p/>
      <p/>
      <p/>
      <p/>
    </html>
    <input type="text" token="textfield">
      <label>Text Field</label>
    </input>
    <input id="horiz_two_radio" type="radio" token="stopwords">
      <label>Remove Stopwords (en)</label>
      <choice value="remove_stopwords=t">Yes</choice>
      <choice value="remove_stopwords=f">No</choice>
      <change>
        <condition value="remove_stopwords=t">
          <unset token="sw_hidden"></unset>
        </condition>
        <condition value="remove_stopwords=f">
          <set token="sw_hidden">True</set>
        </condition>
      </change>
      <default>remove_stopwords=t</default>
      <initialValue>remove_stopwords=t</initialValue>
    </input>
    <input type="text" token="custom_stopwords" rejects="$sw_hidden$">
      <label>Custom Stopwords (comma separated)</label>
      <prefix>custom_stopwords="</prefix>
      <suffix>"</suffix>
      <default></default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Total # Terms</title>
      <single>
        <search base="base_search">
          <query>| stats count BY $textfield$ 
| stats sum(count)</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="height">70</option>
        <option name="rangeColors">["0x1E9C1E","0x1E9C1E"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Avg # Terms Per $textfield$</title>
      <single>
        <search base="base_search">
          <query>| eval count = mvcount($textfield$)
| stats avg(count)</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="height">70</option>
        <option name="rangeColors">["0x1E9C1E","0x1E9C1E"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top Parts-of-Speech Tags</title>
      <chart>
        <search base="base_search">
          <query>| stats count by pos_tag 
| sort -count
| eventstats avg(count) AS avgCount 
| where count &gt; (avgCount /3)
| fields pos_tag count</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">45</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">385</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="pos">$click.value$</set>
          <set token="pos_hidden">TRUE</set>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <title>Top Terms</title>
      <table id="tabledatabar">
        <search base="counts">
          <query>| head 20
| eventstats sum(count) AS total
| eval proportion = (count/total) * 100
| fields - total</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#EC9960" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="specific_word">$row.sentence$</set>
          <set token="word_hidden">TRUE</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$pos_hidden$">
      <table>
        <title>$pos$ Explanation (Sarkar, D. (2016). Text Analytics with Python)</title>
        <search>
          <query>| inputlookup pos_tags.csv
| where TAG=="$pos$"
| table TAG DESCRIPTION EXAMPLE*</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <drilldown>
          <unset token="pos_hidden"></unset>
        </drilldown>
      </table>
      <table>
        <title>Top $pos$ Terms</title>
        <search base="base_search">
          <query>| stats count BY pos_tuple
| sort -count
| search pos_tuple=*$pos$*
| rex field=pos_tuple mode=sed "s/\[\"([^\"]+)\",\"[^\"]+\"\]/\1/"</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#EC9960" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <unset token="pos_hidden"></unset>
        </drilldown>
      </table>
    </panel>
    <panel depends="$word_hidden$">
      <table>
        <title>$specific_word$ Occurences</title>
        <search>
          <query>$master_search$
| regex $textfield$="(?i)\b$specific_word$\b"
| table $textfield$</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <unset token="word_hidden"></unset>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>WordCloud</title>
      <!--<input type="text" token="term_count" id="range" searchWhenChanged="true">
        <label>Terms (25-400)</label>
        <default>50</default>
      </input>-->
      <input type="dropdown" token="term_count" searchWhenChanged="true">
        <label>Terms</label>
        <choice value="25">25</choice>
        <choice value="50">50</choice>
        <choice value="100">100</choice>
        <choice value="200">200</choice>
        <choice value="300">300</choice>
        <choice value="400">400</choice>
        <default>200</default>
        <initialValue>200</initialValue>
      </input>
      <viz type="wordcloud_app.wordcloud">
        <search base="counts">
          <query>| fields $textfield$ count 
| head $term_count$
| rename $textfield$ as "Top keywords"</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="wordcloud_app.wordcloud.alignmentMode">horizontal</option>
        <option name="wordcloud_app.wordcloud.backgroundColor">#fff</option>
        <option name="wordcloud_app.wordcloud.colorBy">colorMode</option>
        <option name="wordcloud_app.wordcloud.colorMode">categorical</option>
        <option name="wordcloud_app.wordcloud.maxColor">#3fc77a</option>
        <option name="wordcloud_app.wordcloud.minColor">#d93f3c</option>
        <option name="wordcloud_app.wordcloud.numOfBins">8</option>
        <option name="wordcloud_app.wordcloud.splunkTastic">false</option>
        <option name="wordcloud_app.wordcloud.useColors">true</option>
      </viz>
    </panel>
    <panel>
      <title>Zipf Plot</title>
      <chart depends="$sw_hidden$">
        <search base="counts">
          <query>| fields "$textfield$" count 
| streamstats count AS rank
| stats first($textfield$) AS $textfield$ first(rank) AS rank BY count
| sort -count
| table "$textfield$" rank count</query>
        </search>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">auto</option>
        <option name="charting.axisX.scale">log</option>
        <option name="charting.axisY.abbreviation">auto</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.chart">scatter</option>
        <option name="charting.chart.showDataLabels">minmax</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">450</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
</form>
